import{r as o,j as e,Q as te,$ as ne,t as G,v as se}from"./vendor-Ds3eAcMw.js";import{C as q,G as Q,T as m,A,a as re,b as W,c as Z,S as I,B as R,d as J,e as H,L as ie,f as le,D as K,g as ae,h as oe,M as ce}from"./vendor_mantine-BUhLSgot.js";import{I as de,a as ue,b as he,c as fe,d as xe,e as pe}from"./vendor_icons-CSPD00rw.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const x of l.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&c(x)}).observe(document,{childList:!0,subtree:!0});function s(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(t){if(t.ep)return;t.ep=!0;const l=s(t);fetch(t.href,l)}})();function me({title:i,children:u,defaultSpan:s=2,onSpanChange:c}){const[t,l]=o.useState(!1),[x,C]=o.useState(s),w=p=>{const j=Math.min(6,Math.max(1,x+p));C(j),c?.(j)};return e.jsxs(q,{shadow:"sm",radius:"md",withBorder:!0,style:{gridColumn:`span ${x}`},children:[e.jsxs(Q,{justify:"space-between",mb:"xs",children:[e.jsx(m,{fw:500,children:i}),e.jsxs(Q,{gap:"xs",children:[e.jsx(A,{onClick:()=>w(-1),variant:"light",children:e.jsx(de,{size:16})}),e.jsx(A,{onClick:()=>w(1),variant:"light",children:e.jsx(ue,{size:16})}),e.jsx(A,{onClick:()=>l(p=>!p),variant:"light",children:t?e.jsx(he,{size:16}):e.jsx(fe,{size:16})})]})]}),e.jsx(re,{in:!t,children:u})]})}function ye({title:i,roomId:u}){const[s,c]=o.useState(!1),t=`${window.location.origin}?roomId=${u}`,l=()=>{navigator.clipboard.writeText(t)};return e.jsx(W,{size:"xs",mt:"xl",children:e.jsx(Z,{children:e.jsxs(I,{align:"center",gap:"md",children:[e.jsx(m,{size:"lg",fw:700,children:i}),s?e.jsxs(I,{align:"center",gap:"sm",children:[e.jsx(J,{value:t,readOnly:!0,style:{width:280}}),e.jsx(H,{label:"In Zwischenablage kopieren",children:e.jsx(A,{onClick:l,variant:"light",children:e.jsx(xe,{size:18})})}),e.jsx("div",{style:{height:"auto",margin:"0 auto",maxWidth:64,width:"100%"},children:e.jsx(te,{size:256,style:{height:"auto",maxWidth:"100%",width:"100%"},value:t,viewBox:"0 0 256 256"})})]}):e.jsx(R,{onClick:()=>c(!0),children:"Raum-Link anzeigen"})]})})})}function ge({currentPlayer:i,nickname:u,scores:s,ready:c,onToggleReady:t,mySide:l,playerNames:x}){return e.jsxs(I,{gap:"xs",mb:"md",align:"center",children:[e.jsxs(m,{size:"lg",fw:700,children:["Aktueller Spieler: ",x[i]," (",i,")"]}),e.jsxs(Q,{gap:"md",children:[e.jsxs(q,{shadow:"sm",padding:"xs",radius:"md",withBorder:!0,children:[e.jsxs(m,{fw:600,children:[x.X," (X)"]}),e.jsxs(m,{size:"sm",children:["Punkte: ",s.X]})]}),e.jsxs(q,{shadow:"sm",padding:"xs",radius:"md",withBorder:!0,children:[e.jsxs(m,{fw:600,children:[x.O," (O)"]}),e.jsxs(m,{size:"sm",children:["Punkte: ",s.O]})]})]}),e.jsxs(m,{size:"sm",c:"dimmed",children:["Du bist: ",u," (",l,")"]}),e.jsx(R,{onClick:t,color:c[l]?"green":"gray",variant:"outline",children:c[l]?"Bereit für neues Spiel ✔":"Bereit machen"})]})}function je(i){const u=[];for(let s=0;s<5;s++)u.push(i[s]),u.push(i.map(c=>c[s]));u.push([0,1,2,3,4].map(s=>i[s][s])),u.push([0,1,2,3,4].map(s=>i[s][4-s]));for(const s of u){if(s.every(c=>c==="X"))return"X";if(s.every(c=>c==="O"))return"O"}return null}function Se({value:i,onClick:u,onCancel:s,disabled:c=!1,isSelected:t=!1,isCorner:l=!1}){return l?e.jsx("div",{style:{width:"100%",height:"100%"}}):e.jsxs("div",{style:{position:"relative",width:"100%",height:"100%",flexShrink:0},children:[e.jsx(R,{onClick:u,disabled:c,color:i==="X"?"blue":i==="O"?"red":"gray",variant:"outline",fullWidth:!0,h:"100%",sx:{width:"100%",height:"100%",padding:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 0.15s ease","&:hover":{opacity:.85}},children:e.jsx("span",{style:{fontSize:"2rem"},children:i??""})}),t&&s&&e.jsx(H,{label:"Auswahl abbrechen",position:"top",withArrow:!0,children:e.jsx(A,{onClick:s,variant:"light",color:"gray",size:"sm",style:{position:"absolute",top:4,right:4,background:"white",zIndex:1},children:e.jsx(pe,{size:"1rem"})})})]})}function we({board:i,currentPlayer:u,mySide:s,onMove:c}){const[t,l]=o.useState(null);let x=i.length,C=i[0].length||x,w=100,p=1+x+1,j=1+C+1;const z=Array.from({length:p},(d,a)=>a),F=Array.from({length:j},(d,a)=>a),B=(d,a)=>{if(t?.row===d&&t?.col===a){l(null);return}else t||l({row:d,col:a})},_=(d,a)=>d===0&&a===0||d===0&&a===j-1||d===p-1&&a===0||d===p-1&&a===j-1,T=(d,a)=>d===0||d===p-1||a===0||a===j-1;return e.jsx("div",{style:{width:"100%",height:"100%",padding:8},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:2},children:z.map(d=>e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:2},children:F.map(a=>{let X=!1,v=t?.row===d&&t?.col===a;const O=i?.[d]?.[a];let P=e.jsx(Se,{value:O,disabled:X,onClick:()=>B(d,a),onCancel:v?()=>l(null):void 0,isSelected:v,isCorner:!1}),S=_(d,a);return!t&&T(d,a)&&(S=!0),S&&(P=null),e.jsx("div",{style:{width:w,height:w},children:P},`${d}-${a}`)})},d))})})}function be(){const[i,u]=o.useState("Anonym"),[s,c]=o.useState(""),[t,l]=o.useState(""),[x,C]=o.useState(!1),[w,p]=o.useState(!1),[j,z]=o.useState(""),[F,B]=o.useState([]),[_,T]=o.useState([]),[d,a]=o.useState(!1),[X,v]=o.useState(Array(5).fill(null).map(()=>Array(5).fill(null))),[O,P]=o.useState("X"),[S,V]=o.useState({X:0,O:0}),[D,E]=o.useState({X:!1,O:!1}),y=o.useRef(null),g=o.useRef({}),M=o.useRef(null),[k,Y]=o.useState("X"),ee={X:k==="X"?i:"Gegner",O:k==="O"?i:"Gegner"};o.useEffect(()=>{const f=new URLSearchParams(window.location.search).get("peerId");f&&$(f)},[]);const L=(n,f)=>{const r=JSON.stringify({type:n,data:f});Object.values(g.current).forEach(h=>{h.open&&h.send(r)})},N=n=>{if(y.current&&!g.current[n]){const f=y.current.connect(n);g.current[n]=f,U(f)}},$=n=>{const f=`${Date.now()}`,r=new ne(f);y.current=r,n&&Y("O"),n&&(p(!0),z(`Verbindung mit Peer ${n} wird aufgebaut...`),M.current=setTimeout(()=>{p(!1),z(""),c(""),alert("Der Peer ist offline oder antwortet nicht."),r.disconnect(),r.destroy(),y.current=null},1e4)),r.on("open",h=>{l(h),n?n!==h&&N(n):(C(!0),window.history.replaceState({},document.title,window.location.pathname))}),r.on("connection",h=>{U(h),h.on("open",()=>{h.send(JSON.stringify({type:"welcome"}))})})},U=n=>{n.on("open",()=>{T(Object.keys(g.current));const f=y.current?.id;if(f){const r=Object.keys(g.current).concat(f);n.send(JSON.stringify({type:"known-peers",data:r}))}L("new-peer",n.peer),Object.keys(g.current).length>0&&a(!0)}),n.on("data",f=>{try{const r=JSON.parse(f);if(r.type==="chat"&&B(h=>[...h,r.data]),r.type==="quixo-state"&&(v(r.data.board),P(r.data.currentPlayer),V(r.data.scores),E(r.data.ready)),r.type==="known-peers"&&r.data.forEach(b=>{b&&b!==y.current?.id&&!g.current[b]&&N(b)}),r.type==="new-peer"){const h=r.data;h&&h!==y.current?.id&&!g.current[h]&&N(h)}r.type==="welcome"&&(clearTimeout(M.current),p(!1),C(!0),window.history.replaceState({},document.title,window.location.pathname))}catch(r){console.warn("Fehler beim Parsen:",r)}}),n.on("close",()=>{delete g.current[n.peer],T(Object.keys(g.current))})};return w?e.jsx(W,{size:"xs",mt:"xl",children:e.jsx(Z,{children:e.jsxs(I,{align:"center",children:[e.jsx(ie,{size:"xl"}),e.jsx(m,{children:j}),e.jsx(R,{variant:"light",color:"red",onClick:()=>{clearTimeout(M.current),p(!1),z(""),c(""),y.current?.disconnect(),y.current?.destroy(),y.current=null},children:"Verbindung abbrechen"})]})})}):x?e.jsx(ae,{padding:"md",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ge,{currentPlayer:O,nickname:i,scores:S,ready:D,onToggleReady:()=>{const n={...D,[k]:!D[k]};E(n),L("quixo-state",{board:X,currentPlayer:O,scores:S,ready:n})},mySide:k,playerNames:ee}),e.jsx(we,{board:X,currentPlayer:O,mySide:k,onMove:n=>{const f=O==="X"?"O":"X",r=je(n);if(r){const h={...S,[r]:S[r]+1},b=Array(5).fill(null).map(()=>Array(5).fill(null));V(h),v(b),P("X"),E({X:!1,O:!1}),L("quixo-state",{board:b,currentPlayer:"X",scores:h,ready:{X:!1,O:!1}})}else v(n),P(f),L("quixo-state",{board:n,currentPlayer:f,scores:S,ready:{X:!1,O:!1}})}})]}):e.jsx(oe,{cols:6,spacing:"md",children:e.jsx(me,{title:"Warte auf zweiten Spieler ...",defaultSpan:6,children:e.jsxs(I,{align:"center",gap:"sm",children:[e.jsx(m,{children:"Ein weiterer Spieler muss dem Spiel beitreten."}),e.jsx(ye,{title:"Raum-Link teilen",roomId:t})]})})})}):e.jsxs(W,{size:"xs",mt:"xl",children:[e.jsx(le,{order:2,mb:"md",children:"Penta-Push"}),e.jsxs(I,{children:[e.jsx(m,{children:"Gib deinen Namen ein:"}),e.jsx(J,{value:i,onChange:n=>u(n.currentTarget.value)}),e.jsx(K,{my:"sm",label:"Raum beitreten",labelPosition:"center"}),e.jsx(J,{placeholder:"Peer-ID eingeben",value:s,onChange:n=>c(n.currentTarget.value)}),e.jsx(R,{onClick:()=>$(s),children:"Beitreten"}),e.jsx(K,{my:"sm",label:"Oder neuen Link erstellen",labelPosition:"center"}),e.jsx(R,{onClick:()=>$(),children:"Eigenen Link erstellen"})]})]})}window.process=G;typeof G.nextTick!="function"&&(G.nextTick=i=>Promise.resolve().then(i));se.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(ce,{withGlobalStyles:!0,withNormalizeCSS:!0,children:e.jsx(be,{})})}));
